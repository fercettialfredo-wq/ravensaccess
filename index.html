<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ravens Access</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        html, body { height: 100%; margin: 0; padding: 0; overflow-x: hidden; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #000000; }
        #app-container { min-height: 100vh; display: flex; flex-direction: column; background-color: #000000; }
        .header-app { background-color: #000000; color: white; padding: 1rem; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .header-logo { display: flex; align-items: center; }
        .header-logo img { height: 40px; margin-right: 15px; filter: brightness(0) invert(1); }
        .header-logo-text { font-weight: bold; font-size: 1.75rem; color: white; text-transform: uppercase; }
        .screen { display: none; flex-grow: 1; flex-direction: column; }
        .screen.active { display: flex; }
        #login-screen { background-color: #000000; align-items: center; justify-content: center; padding: 1rem; }
        .login-header { display: flex; flex-direction: column; align-items: center; margin-bottom: 2rem; margin-top: -10vh; }
        .login-header img { height: 60px; margin-bottom: 1rem; filter: brightness(0) invert(1); }
        .login-header-text { font-weight: bold; font-size: 2.25rem; color: white; text-transform: uppercase; }
        .main-title-box { background-color: #5a1a2e; padding: 1rem 2.5rem; border-radius: 0.5rem; font-size: 1.5rem; font-weight: bold; color: white; text-transform: uppercase; box-shadow: 0 4px 10px rgba(0,0,0,0.3); margin-top: 1.5rem; margin-bottom: 2rem; }
        .password-container { position: relative; display: flex; align-items: center; }
        #togglePassword { position: absolute; right: 0.75rem; cursor: pointer; color: #4a5568; }
        .main-menu-grid { flex-grow: 1; display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; padding: 1.5rem; background-color: #000000; }
        .menu-item { background-color: #5a1a2e; border-radius: 0.5rem; padding: 1rem; text-align: center; color: white; cursor: pointer; transition: background-color 0.3s; display: flex; flex-direction: column; justify-content: center; align-items: center; font-weight: bold; font-size: 1.1rem; }
        .menu-item:hover { background-color: #4e1628; }
        .menu-item-icon { font-size: 3rem; margin-bottom: 0.5rem; }
        .form-page { flex-direction: column; height: 100%; }
        .form-title-section { background-color: #1f2937; color: white; padding: 1rem 1.5rem; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
        .form-title { font-size: 1.25rem; font-weight: bold; }
        .form-container { padding: 1.5rem; flex-grow: 1; overflow-y: auto; background-color: #ffffff; }
        .btn-primary { background-color: #5a1a2e; color: white; padding: 0.75rem 1.5rem; border-radius: 0.375rem; font-weight: bold; text-align: center; cursor: pointer; transition: background-color 0.2s ease; }
        .btn-primary:hover { background-color: #4e1628; }
        .btn-save { background-color: #16a34a; color: white; font-weight: bold; text-align: center; cursor: pointer; transition: background-color 0.2s ease; }
        .btn-save:hover { background-color: #128a3f; }
        input, select { border-color: #cbd5e1 !important; color: #1f2937 !important; }
        input:focus, select:focus { --tw-ring-color: #5a1a2e !important; border-color: #5a1a2e !important; }
        input[type="password"] { padding-right: 2.5rem; }
    </style>
</head>
<body>
    <div id="app-container" class="max-w-md mx-auto shadow-lg">
        <div id="login-screen" class="screen active">
            <div class="login-header">
                <img src="logo.png" alt="Ravens Logo">
                <h1 class="login-header-text">Ravens Access</h1>
            </div>
            <div class="main-title-box"> Control de Acceso </div>
            <div class="w-full max-w-sm bg-white rounded-lg shadow-xl p-6">
                <h2 class="text-2xl font-bold text-center mb-6 text-gray-800">Iniciar Sesi√≥n</h2>
                <div class="space-y-4">
                    <div>
                        <label for="username" class="block text-sm font-medium text-gray-700">Usuario</label>
                        <input type="text" id="username" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2">
                    </div>
                    <div>
                        <label for="password" class="block text-sm font-medium text-gray-700">Contrase√±a</label>
                        <div class="password-container">
                            <input type="password" id="password" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2">
                            <i class="fas fa-eye" id="togglePassword"></i>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <input id="remember-me" name="remember-me" type="checkbox" class="h-4 w-4 rounded border-gray-300" style="color: #5a1a2e;">
                        <label for="remember-me" class="ml-2 block text-sm text-gray-900">Recordarme</label>
                    </div>
                    <p id="login-error" class="text-red-600 text-sm text-center hidden"></p>
                    <button id="login-button" class="w-full btn-primary">Entrar</button>
                </div>
            </div>
        </div>
        <div id="menu-screen" class="screen">
            <header class="header-app"><div class="header-logo"><img src="logo.png" alt="Ravens Logo" class="filter brightness-0 invert"><span class="header-logo-text">RAVENS ACCESS</span></div></header>
            <div class="main-menu-grid">
                <div class="menu-item" onclick="showScreen('residente-form')"><div class="menu-item-icon">üë•</div><div>Residente</div></div>
                <div class="menu-item" onclick="showScreen('visita-form')"><div class="menu-item-icon">ü§ù</div><div>Visita</div></div>
                <div class="menu-item" onclick="showScreen('evento-form')"><div class="menu-item-icon">üìÖ</div><div>Evento</div></div>
                <div class="menu-item" onclick="showScreen('servicio-form')"><div class="menu-item-icon">üë∑</div><div>Personal de servicio</div></div>
                <div class="menu-item" onclick="showScreen('qr-form')"><div class="menu-item-icon">üóëÔ∏è</div><div>Eliminar QR</div></div>
                <div class="menu-item" onclick="showScreen('incidencias-form')"><div class="menu-item-icon">üì±</div><div>Incidencias</div></div>
            </div>
        </div>
        <div id="residente-form" class="screen form-page" data-form-id="Residente">
            <header class="header-app"><div class="header-logo"><img src="logo.png" alt="Ravens Logo" class="filter brightness-0 invert"><span class="header-logo-text">RAVENS ACCESS</span></div></header>
            <div class="form-title-section"><h2 class="form-title">Residente</h2><div class="home-icon cursor-pointer" onclick="showScreen('menu-screen')"><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" /></svg></div></div>
            <div class="form-container">
                <div class="space-y-4">
                    <div><label class="block font-bold text-gray-700">Nombre</label><input type="text" data-field="Nombre" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2"></div>
                    <div><label class="block font-bold text-gray-700">Torre</label><input type="text" data-field="Torre" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2"></div>
                    <div><label class="block font-bold text-gray-700">Departamento</label><input type="text" data-field="Departamento" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2"></div>
                    <div><label class="block font-bold text-gray-700">N√∫mero</label><input type="text" data-field="Numero" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2"></div>
                </div>
                <div class="mt-8"><div class="btn-save w-full text-center py-3 rounded-md">Guardar</div></div>
            </div>
        </div>
        <div id="visita-form" class="screen form-page" data-form-id="Visita">
            <header class="header-app"><div class="header-logo"><img src="logo.png" alt="Ravens Logo" class="filter brightness-0 invert"><span class="header-logo-text">RAVENS ACCESS</span></div></header>
            <div class="form-title-section"><h2 class="form-title">Visita</h2><div class="home-icon cursor-pointer" onclick="showScreen('menu-screen')"><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" /></svg></div></div>
            <div class="form-container">
                <div class="space-y-4">
                    <div><label class="block font-bold text-gray-700">Nombre</label><input type="text" data-field="Nombre" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2"></div>
                    <div><label class="block font-bold text-gray-700">Torre</label><input type="text" data-field="Torre" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2"></div>
                    <div><label class="block font-bold text-gray-700">Departamento</label><input type="text" data-field="Departamento" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2"></div>
                    <div><label class="block font-bold text-gray-700">N√∫mero</label><input type="text" data-field="Numero" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2"></div>
                </div>
                <div class="mt-8"><div class="btn-save w-full text-center py-3 rounded-md">Guardar</div></div>
            </div>
        </div>
        <div id="evento-form" class="screen form-page" data-form-id="Evento">
            <header class="header-app"><div class="header-logo"><img src="logo.png" alt="Ravens Logo" class="filter brightness-0 invert"><span class="header-logo-text">RAVENS ACCESS</span></div></header>
            <div class="form-title-section"><h2 class="form-title">Evento</h2><div class="home-icon cursor-pointer" onclick="showScreen('menu-screen')"><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" /></svg></div></div>
            <div class="form-container">
                <div class="space-y-4">
                    <div><label class="block font-bold text-gray-700">Nombre</label><input type="text" data-field="Nombre" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2"></div>
                    <div><label class="block font-bold text-gray-700">Torre</label><input type="text" data-field="Torre" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2"></div>
                    <div><label class="block font-bold text-gray-700">Departamento</label><input type="text" data-field="Departamento" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2"></div>
                    <div><label class="block font-bold text-gray-700">N√∫mero</label><input type="text" data-field="Numero" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2"></div>
                    <div><label class="block font-bold text-gray-700">N QR</label><select data-field="N_QR" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2"><option>1</option><option>2</option><option>5</option><option>10</option></select></div>
                </div>
                <div class="mt-8"><div class="btn-save w-full text-center py-3 rounded-md">Guardar</div></div>
            </div>
        </div>
        <div id="servicio-form" class="screen form-page" data-form-id="Personal de servicio">
            <header class="header-app"><div class="header-logo"><img src="logo.png" alt="Ravens Logo" class="filter brightness-0 invert"><span class="header-logo-text">RAVENS ACCESS</span></div></header>
            <div class="form-title-section"><h2 class="form-title">Personal de Servicio</h2><div class="home-icon cursor-pointer" onclick="showScreen('menu-screen')"><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" /></svg></div></div>
            <div class="form-container">
                <div class="space-y-4">
                    <div><label class="block font-bold text-gray-700">Nombre</label><input type="text" data-field="Nombre" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2"></div>
                    <div><label class="block font-bold text-gray-700">Torre</label><input type="text" data-field="Torre" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2"></div>
                    <div><label class="block font-bold text-gray-700">Departamento</label><input type="text" data-field="Departamento" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2"></div>
                    <div><label class="block font-bold text-gray-700">N√∫mero</label><input type="text" data-field="Numero" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2"></div>
                </div>
                <div class="mt-8"><div class="btn-save w-full text-center py-3 rounded-md">Guardar</div></div>
            </div>
        </div>
        <div id="qr-form" class="screen form-page" data-form-id="Eliminar QR">
            <header class="header-app"><div class="header-logo"><img src="logo.png" alt="Ravens Logo" class="filter brightness-0 invert"><span class="header-logo-text">RAVENS ACCESS</span></div></header>
            <div class="form-title-section"><h2 class="form-title">Eliminar QR</h2><div class="home-icon cursor-pointer" onclick="showScreen('menu-screen')"><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" /></svg></div></div>
            <div class="form-container">
                <div class="space-y-4">
                    <div><label class="block font-bold text-gray-700">Nombre</label><input type="text" data-field="Nombre" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2"></div>
                    <div><label class="block font-bold text-gray-700">Torre</label><input type="text" data-field="Torre" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2"></div>
                    <div><label class="block font-bold text-gray-700">Departamento</label><input type="text" data-field="Departamento" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2"></div>
                    <div><label class="block font-bold text-gray-700">Nombre QR</label><input type="text" data-field="Nombre_QR" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2"></div>
                </div>
                <div class="mt-8"><div class="btn-save w-full text-center py-3 rounded-md">Guardar</div></div>
            </div>
        </div>
        <div id="incidencias-form" class="screen form-page" data-form-id="Incidencias">
            <header class="header-app"><div class="header-logo"><img src="logo.png" alt="Ravens Logo" class="filter brightness-0 invert"><span class="header-logo-text">RAVENS ACCESS</span></div></header>
            <div class="form-title-section"><h2 class="form-title">Incidencias</h2><div class="home-icon cursor-pointer" onclick="showScreen('menu-screen')"><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" /></svg></div></div>
            <div class="form-container">
                <div class="space-y-4">
                    <div><label class="block font-bold text-gray-700">Nombre</label><input type="text" data-field="Nombre" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2"></div>
                    <div><label class="block font-bold text-gray-700">Torre</label><input type="text" data-field="Torre" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2"></div>
                    <div><label class="block font-bold text-gray-700">Departamento</label><input type="text" data-field="Departamento" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2"></div>
                    <div><label class="block font-bold text-gray-700">Incidencia</label><input type="text" data-field="Incidencia" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2"></div>
                </div>
                <div class="mt-8"><div class="btn-save w-full text-center py-3 rounded-md">Guardar</div></div>
            </div>
        </div>
        <div id="confirmation-popup" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
             <div class="bg-white p-6 rounded-lg shadow-xl text-center">
                <h3 class="text-lg font-bold mb-4 text-gray-800">¬°Guardado!</h3>
                <p class="text-gray-600">Los datos han sido enviados correctamente.</p>
                <button id="popup-ok-btn" class="mt-6 bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700">OK</button>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIGURACI√ìN ---
        const AZURE_FUNCTION_URL = 'https://appvalidar.azurewebsites.net/api/processFormData?code=diC_fsfHBzDhxSQajupH-Vr78Lh6W2JA6R59VJlQo1cFAzFu4ly9RQ==';

        document.addEventListener('DOMContentLoaded', () => {
            let currentUser = {}; 

            const screens = document.querySelectorAll('.screen');
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            const rememberMeCheckbox = document.getElementById('remember-me');
            const loginButton = document.getElementById('login-button');
            const togglePassword = document.getElementById('togglePassword');
            const loginError = document.getElementById('login-error');
            
            togglePassword.addEventListener('click', function () {
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);
                this.classList.toggle('fa-eye');
                this.classList.toggle('fa-eye-slash');
            });

            const rememberedUser = localStorage.getItem('rememberedUser');
            if (rememberedUser) {
                usernameInput.value = rememberedUser;
                rememberMeCheckbox.checked = true;
            }

            window.showScreen = function(screenId) {
                screens.forEach(screen => screen.classList.remove('active'));
                const activeScreen = document.getElementById(screenId);
                if (activeScreen) activeScreen.classList.add('active');
            };
            
            loginButton.addEventListener('click', async () => {
                const username = usernameInput.value.trim();
                const password = passwordInput.value;
                loginError.classList.add('hidden');
                
                loginButton.disabled = true;
                loginButton.textContent = 'Verificando...';

                try {
                    const response = await fetch(AZURE_FUNCTION_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ username, password })
                    });
                    
                    const data = await response.json();

                    if (!response.ok || !data.success) {
                        throw new Error(data.message || 'Credenciales inv√°lidas');
                    }
                    
                    currentUser = { username: username, condominio: data.condominio };
                    if (rememberMeCheckbox.checked) {
                        localStorage.setItem('rememberedUser', username);
                    } else {
                        localStorage.removeItem('rememberedUser');
                    }
                    showScreen('menu-screen');

                } catch (error) {
                    loginError.textContent = error.message;
                    loginError.classList.remove('hidden');
                } finally {
                    loginButton.disabled = false;
                    loginButton.textContent = 'Entrar';
                }
            });

            const saveButtons = document.querySelectorAll('.btn-save');
            saveButtons.forEach(button => {
                button.addEventListener('click', async (event) => {
                    const formPage = event.target.closest('.form-page');
                    const formId = formPage.dataset.formId;
                    const inputs = formPage.querySelectorAll('input[data-field], select[data-field]');
                    
                    const data = { 
                        formulario: formId,
                        condominio: currentUser.condominio || 'No especificado',
                        registradoPor: currentUser.username || 'No especificado'
                    };
                    let allFieldsValid = true;

                    inputs.forEach(input => {
                        data[input.dataset.field] = input.value;
                        if (!input.value && input.type !== 'checkbox') {
                           allFieldsValid = false;
                        }
                    });

                    if (!allFieldsValid) {
                        alert("Por favor, rellena todos los campos.");
                        return;
                    }
                    
                    try {
                        const response = await fetch(AZURE_FUNCTION_URL, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(data)
                        });
                        if (!response.ok) throw new Error('Error al guardar los datos');
                        
                        showConfirmationPopup();

                    } catch (error) {
                        console.error("Error al enviar datos:", error);
                        alert("Hubo un error al guardar los datos.");
                    }
                });
            });

            const popup = document.getElementById('confirmation-popup');
            const okBtn = document.getElementById('popup-ok-btn');
            
            function showConfirmationPopup() {
                if(popup) popup.style.display = 'flex';
            }

            if(okBtn) {
                okBtn.addEventListener('click', () => {
                    if(popup) popup.style.display = 'none';
                    const activeForm = document.querySelector('.form-page.active');
                    if(activeForm) {
                        activeForm.querySelectorAll('input[data-field], select[data-field]').forEach(input => {
                            if (input.tagName === 'SELECT') input.selectedIndex = 0;
                            else input.value = '';
                        });
                    }
                    showScreen('menu-screen');
                });
            }
        });
    </script>
</body>
</html>
