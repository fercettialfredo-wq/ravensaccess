<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ravens Access</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        html, body {
            height: 100%;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }
        #app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .header-app {
            background-color: #000000;
            color: white;
            padding: 1rem;
            display: flex;
            align-items: center;
            justify-content: center; /* Centramos el contenido del header */
            flex-shrink: 0;
        }
        .header-logo {
            display: flex;
            align-items: center;
        }
        .header-logo img {
            height: 40px;
            margin-right: 15px;
        }
        .header-logo-text {
            font-weight: bold;
            font-size: 1.75rem; /* <-- TAMA√ëO AUMENTADO */
            color: white;
            text-transform: uppercase;
        }
        .screen {
            display: none;
            flex-grow: 1;
            flex-direction: column;
        }
        .screen.active {
            display: flex;
        }
        .main-content-area {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-image: url('https://images.unsplash.com/photo-1554034483-04fda0d3507b?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80'); /* Imagen de fondo gen√©rica */
            background-size: cover;
            background-position: center;
            color: white;
            text-align: center;
            padding: 2rem;
        }
        .main-title-box {
            background-color: #5a1a2e;
            padding: 1.5rem 3rem;
            border-radius: 0.5rem;
            font-size: 2.5rem; /* Ajustado para el nuevo texto */
            font-weight: bold;
            color: white;
            text-transform: uppercase;
            box-shadow: 0 4px S10px rgba(0,0,0,0.3);
        }
        .form-container {
            padding: 1.5rem;
            background-color: #f7fafc;
            border-radius: 0.5rem;
            flex-grow: 1;
            overflow-y: auto;
        }
        /* Contenedor para el input de contrase√±a y el √≠cono */
        .password-container {
            position: relative;
            display: flex;
            align-items: center;
        }
        /* Estilo para el √≠cono del ojo */
        #togglePassword {
            position: absolute;
            right: 0.75rem; /* 12px */
            cursor: pointer;
            color: #4a5568; /* gris */
        }
        .main-menu-grid {
            flex-grow: 1;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            padding: 1.5rem;
            background-color: #333333;
            color: white;
        }
        .menu-item {
            background-color: #5a1a2e;
            border-radius: 0.5rem;
            padding: 1rem;
            text-align: center;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 1.1rem;
        }
        .menu-item:hover {
            background-color: #d90f48;
        }
        .menu-item-icon {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }
        .form-title-section {
            background-color: #5a1a2e;
            color: white;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .form-title {
            font-size: 1.8rem;
            font-weight: bold;
        }
        .btn {
            background-color: #d90f48;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.375rem;
            font-weight: bold;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .btn:hover {
            background-color: #a30b3d;
        }
        .btn-save {
            background-color: #16a34a;
            color: white;
        }
        .btn-save:hover {
            background-color: #128a3f;
        }
        input, select {
            border-color: #000000 !important;
        }
        /* Padding a la derecha para que el texto no se solape con el √≠cono */
        input[type="password"], input[type="text"]#password {
             padding-right: 2.5rem; /* 40px */
        }
    </style>
</head>
<body class="bg-gray-100">

    <div id="app-container" class="max-w-md mx-auto bg-white shadow-lg">

        <div id="login-screen" class="screen">
            <header class="header-app">
                <div class="header-logo">
                    <img src="logo.png" alt="Ravens Logo" class="filter brightness-0 invert">
                    <span class="header-logo-text">RAVENS ACCESS</span>
                </div>
            </header>

            <div class="main-content-area">
                <div class="main-title-box">
                    Control de Acceso </div>

                <div class="form-container mt-8 w-11/12 max-w-sm bg-white rounded-lg shadow-xl p-6">
                    <h2 class="text-2xl font-bold text-center mb-6 text-gray-800">Iniciar Sesi√≥n</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="username" class="block text-sm font-medium text-gray-700">Usuario</label>
                            <input type="text" id="username" class="mt-1 block w-full px-3 py-2 border border-black rounded-md shadow-sm focus:outline-none focus:ring-red-700 focus:border-red-700">
                        </div>
                        <div>
                            <label for="password" class="block text-sm font-medium text-gray-700">Contrase√±a</label>
                            <div class="password-container">
                                <input type="password" id="password" class="mt-1 block w-full px-3 py-2 border border-black rounded-md shadow-sm focus:outline-none focus:ring-red-700 focus:border-red-700">
                                <i class="fas fa-eye" id="togglePassword"></i> </div>
                        </div>
                        <div class="flex items-center justify-start">
                            <div class="flex items-center">
                                <input id="remember-me" name="remember-me" type="checkbox" class="h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded">
                                <label for="remember-me" class="ml-2 block text-sm text-gray-900">
                                    Recordarme
                                </label>
                            </div>
                        </div>
                        <p id="login-error" class="text-red-500 text-sm text-center hidden">Usuario o contrase√±a incorrectos.</p>
                        <button id="login-button" class="w-full btn bg-red-700 hover:bg-red-800">
                            Entrar
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="menu-screen" class="screen">
             <header class="header-app">
                <div class="header-logo">
                    <img src="logo.png" alt="Ravens Logo" class="filter brightness-0 invert">
                    <span class="header-logo-text">RAVENS ACCESS</span>
                </div>
            </header>
            <div class="main-menu-grid">
                <div class="menu-item" onclick="showScreen('residente-form')"><div class="menu-item-icon">üë•</div><div>Residente</div></div>
                <div class="menu-item" onclick="showScreen('visita-form')"><div class="menu-item-icon">ü§ù</div><div>Visita</div></div>
                <div class="menu-item" onclick="showScreen('evento-form')"><div class="menu-item-icon">üìÖ</div><div>Evento</div></div>
                <div class="menu-item" onclick="showScreen('servicio-form')"><div class="menu-item-icon">üë∑</div><div>Personal de servicio</div></div>
                <div class="menu-item" onclick="showScreen('qr-form')"><div class="menu-item-icon">üóëÔ∏è</div><div>Eliminar QR</div></div>
                <div class="menu-item" onclick="showScreen('incidencias-form')"><div class="menu-item-icon">üì±</div><div>Incidencias</div></div>
            </div>
        </div>
        
        <div id="residente-form" class="screen form-page" data-form-id="Residente">
            <header class="header-app"><div class="header-logo"><img src="logo.png" alt="Ravens Logo" class="filter brightness-0 invert"><span class="header-logo-text">RAVENS ACCESS</span></div></header>
            <div class="form-title-section"><h2 class="form-title">Residente</h2><div class="home-icon text-white hover:text-red-300" onclick="showScreen('menu-screen')"><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" /></svg></div></div>
            <div class="form-container">
                <div class="space-y-4">
                    <div><label class="block font-bold text-gray-700">Nombre</label><input type="text" data-field="Nombre" class="mt-1 block w-full px-3 py-2 border border-black rounded-md focus:ring-red-700 focus:border-red-700"></div>
                    <div><label class="block font-bold text-gray-700">Torre</label><input type="text" data-field="Torre" class="mt-1 block w-full px-3 py-2 border border-black rounded-md focus:ring-red-700 focus:border-red-700"></div>
                    <div><label class="block font-bold text-gray-700">Departamento</label><input type="text" data-field="Departamento" class="mt-1 block w-full px-3 py-2 border border-black rounded-md focus:ring-red-700 focus:border-red-700"></div>
                    <div><label class="block font-bold text-gray-700">N√∫mero</label><input type="text" data-field="Numero" class="mt-1 block w-full px-3 py-2 border border-black rounded-md focus:ring-red-700 focus:border-red-700"></div>
                </div>
                <div class="form-buttons mt-8"><div class="btn btn-save w-full">Guardar</div></div>
            </div>
        </div>

        <div id="confirmation-popup" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
             <div class="bg-white p-6 rounded-lg shadow-xl text-center">
                <h3 class="text-lg font-bold mb-4 text-gray-800">¬°Guardado!</h3>
                <p class="text-gray-600">Los datos han sido enviados correctamente.</p>
                <button id="popup-ok-btn" class="mt-6 bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700">OK</button>
            </div>
        </div>

    </div>

    <script>
        // ... (Configuraci√≥n de URL sin cambios) ...
        const POWER_AUTOMATE_URL = 'URL_AQUI';

        document.addEventListener('DOMContentLoaded', () => {
            const screens = document.querySelectorAll('.screen');
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            const rememberMeCheckbox = document.getElementById('remember-me');
            const loginButton = document.getElementById('login-button');

            // --- L√ìGICA PARA MOSTRAR/OCULTAR CONTRASE√ëA ---
            const togglePassword = document.getElementById('togglePassword');
            togglePassword.addEventListener('click', function () {
                // Cambiar el tipo de input
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);
                // Cambiar el √≠cono del ojo
                this.classList.toggle('fa-eye');
                this.classList.toggle('fa-eye-slash');
            });

            // ... (L√≥gica de "Recordarme" sin cambios) ...
            const rememberedUser = localStorage.getItem('rememberedUser');
            if (rememberedUser) {
                usernameInput.value = rememberedUser;
                rememberMeCheckbox.checked = true;
            }


            window.showScreen = function(screenId) {
                screens.forEach(screen => screen.classList.remove('active'));
                const activeScreen = document.getElementById(screenId);
                if (activeScreen) activeScreen.classList.add('active');
            };
            
            // --- L√ìGICA DE LOGIN ACTUALIZADA ---
            loginButton.addEventListener('click', async () => {
                const username = usernameInput.value.trim();
                const password = passwordInput.value;
                const errorMsg = document.getElementById('login-error');
                errorMsg.classList.add('hidden');

                // --- LOGIN TEMPORAL PARA DESARROLLO ---
                if (username === 'alfredofercetti' && password === '12345') {
                    console.log('Acceso de desarrollador concedido.');
                    if (rememberMeCheckbox.checked) {
                        localStorage.setItem('rememberedUser', username);
                    } else {
                        localStorage.removeItem('rememberedUser');
                    }
                    showScreen('menu-screen');
                    return; // Detiene la ejecuci√≥n para no llamar a Power Automate
                }
                
                // --- L√≥gica de Power Automate (para otros usuarios) ---
                loginButton.disabled = true;
                loginButton.textContent = 'Verificando...';

                try {
                    // ... (Aqu√≠ va tu fetch a Power Automate como lo ten√≠as) ...
                    // Simulaci√≥n de fallo para cualquier otro usuario
                    console.log('Intentando validar con Power Automate...');
                    await new Promise(resolve => setTimeout(resolve, 1000)); // Simula espera de red
                    throw new Error("Validaci√≥n fallida");

                } catch (error) {
                    console.error('Error de validaci√≥n:', error);
                    errorMsg.classList.remove('hidden');
                } finally {
                    loginButton.disabled = false;
                    loginButton.textContent = 'Entrar';
                }
            });

            // ... (El resto de tu l√≥gica de formularios y popups sin cambios) ...
        
            showScreen('login-screen');
        });
    </script>
</body>
</html>
